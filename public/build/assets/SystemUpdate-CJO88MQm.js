import{j as e}from"./markdown-CGR2RDhP.js";import{a as m,H}from"./vendor-4eYsLQor.js";import{A as I}from"./AdminLayout-BURJOEap.js";import{u as K,a as B}from"./app-D2UQJoir.js";import{I as p}from"./Icon-4HnnCzTR.js";import{m as j}from"./proxy-CfrAqMoI.js";import"./index-Cn3or5DS.js";import"./Footer-BDJLv4qB.js";import"./app-CkAIrV6T.js";const q=R=>{const S=`; ${document.cookie}`.split(`; ${R}=`);return S.length===2?S.pop().split(";").shift():null},le=({footerSettings:R,currentVersion:w,updateAvailable:S,latestVersion:f,lastUpdated:U})=>{const x=K(),{isDarkMode:J}=B(),[h,v]=m.useState(!1),[L,d]=m.useState([]),[l,o]=m.useState("idle"),[Y,n]=m.useState(0),[z,V]=m.useState(null),[D,W]=m.useState(null),[N,A]=m.useState(0),[T,P]=m.useState([]),F=async()=>{try{const t=await fetch("/admin/system/update-history",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),"X-XSRF-TOKEN":q("XSRF-TOKEN")},credentials:"same-origin",redirect:"follow"});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const a=await t.text();let i;try{i=JSON.parse(a)}catch{console.warn("History API response not JSON:",a.slice(0,200));return}i?.success&&Array.isArray(i.items)?P(i.items):console.warn("History API returned invalid data:",i)}catch(t){console.warn("History loading failed:",t.message)}},X=async()=>{o("checking"),d(["ğŸ” YeniliklÉ™r yoxlanÄ±lÄ±r..."]),n(0);try{const t=await fetch("/admin/system/check-updates",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",redirect:"follow"}),a=await t.text();let i;try{i=JSON.parse(a)}catch{throw new Error((t.redirected?"YÃ¶nlÉ™ndirmÉ™ baÅŸ verdi. ":"")+(a?a.slice(0,200):"Server JSON qaytarmadÄ±."))}if(i.success)i.has_update?(d(s=>[...s,`ğŸ†• Yeni versiya mÃ¶vcuddur! v${i.latest_version}`]),i.release_notes&&d(s=>[...s,`ğŸ“ DÉ™yiÅŸikliklÉ™r: ${i.release_notes.slice(0,100)}...`]),o("update-available"),window.updateDownloadUrl=i.download_url):(d(s=>[...s,"âœ… Skriptiniz son versiyadÄ±r!"]),o("up-to-date"));else throw new Error(i.message||"BilinmÉ™yÉ™n xÉ™ta")}catch(t){d(a=>[...a,"âŒ Yoxlama xÉ™tasÄ±: "+t.message]),o("error")}},E=["YenilÉ™mÉ™ baÅŸlandÄ±","Sistem hazÄ±rlÄ±ÄŸÄ± yoxlanÄ±lÄ±r","Backup yaradÄ±lÄ±r","BakÄ±m rejimi aktivlÉ™ÅŸir","Update paketi endirilir","Paket yÃ¼klÉ™nir","Fayllar kopyalanÄ±r","Frontend assets quraÅŸdÄ±rÄ±lÄ±r","VerilÉ™nlÉ™r bazasÄ± yenilÉ™nir","AsÄ±lÄ±lÄ±qlar yoxlanÄ±lÄ±r","Sistem cache-i yenilÉ™nir","QuraÅŸdÄ±rma doÄŸrulanÄ±r","Versiya yenilÉ™nir","YenilÉ™mÉ™ tamamlandÄ±"],C=t=>{const a=[{pattern:/KÃ–KLÃœ AVTOMATÄ°K YENÄ°LÆMÆ BAÅLANDI/,progress:5,step:0},{pattern:/Sistem hazÄ±rlÄ±ÄŸÄ± yoxlanÄ±lÄ±r/,progress:10,step:1},{pattern:/Atom backup yaradÄ±lÄ±r/,progress:15,step:2},{pattern:/Maintenance mode aktivlÉ™ÅŸir/,progress:20,step:3},{pattern:/Update paketi endirilir/,progress:25,step:4},{pattern:/Downloaded via/,progress:35,step:5},{pattern:/Fayllar deploy edilir/,progress:45,step:6},{pattern:/Frontend assets deploy edilir/,progress:55,step:7},{pattern:/Database yenilÉ™nir/,progress:65,step:8},{pattern:/Dependencies yoxlanÄ±lÄ±r/,progress:75,step:9},{pattern:/System cache yenilÉ™nir/,progress:85,step:10},{pattern:/Deployment yoxlanÄ±lÄ±r/,progress:90,step:11},{pattern:/Versiya yenilÉ™nir/,progress:95,step:12},{pattern:/YENÄ°LÆMÆ TAMAMILÆ UÄURLU/,progress:100,step:13}];let i=0,s=0;for(const b of t)for(const u of a)u.pattern.test(b)&&u.progress>i&&(i=u.progress,s=u.step);return{progress:i,step:s}},O=async()=>{if(confirm(`Sistem yenilÉ™mÉ™yÉ™ baÅŸlayacaq. Bu proses 2-5 dÉ™qiqÉ™ Ã§É™kÉ™ bilÉ™r.

Davam etmÉ™k istÉ™yirsiniz?`)){if(!window.updateDownloadUrl){x.error("Download URL tapÄ±lmadÄ±. ÆvvÉ™lcÉ™ yeniliklÉ™r yoxlayÄ±n.");return}v(!0),o("updating"),d(["âŸ³ Sistem yenilÉ™nmÉ™si baÅŸlandÄ±..."]),n(0),A(0);try{const t=await fetch("/admin/system/perform-update",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"X-XSRF-TOKEN":q("XSRF-TOKEN")},credentials:"same-origin",body:JSON.stringify({download_url:window.updateDownloadUrl})}),a=t.body?.getReader(),i=new TextDecoder("utf-8");let s="";if(a)for(;;){const{done:r,value:c}=await a.read();if(r)break;const g=i.decode(c,{stream:!0});s+=g;const y=s.split(`
`).filter(_=>_.trim());d(y);const{progress:M,step:$}=C(y);M>0&&(n(M),A($))}else{s=await t.text();const r=s.split(`
`).filter(y=>y.trim());d(r);const{progress:c,step:g}=C(r);c>0&&(n(c),A(g))}if(t.status===419)throw new Error("CSRF token uyuÅŸmazlÄ±ÄŸÄ±. SÉ™hifÉ™ni yenilÉ™yib yenidÉ™n cÉ™hd edin.");const b=/\[\[UPDATE_SUCCESS\]\]/.test(s),u=/\[\[UPDATE_FAILED\]\]/.test(s),k=b||/YENÄ°LÆMÆ TAMAMILÆ UÄURLU/i.test(s);if(t.ok&&k&&!u){const r=s.match(/\u2728\s*([0-9.]+)\s*(?:\u2192|->)\s*v?([0-9.]+)/),c=r?.[1]||w,g=r?.[2]||f||"latest";n(100),o("completed"),d(y=>[...y,`âœ“ Son versiyaya mÃ¼vÉ™ffÉ™qiyyÉ™tlÉ™ yenilÉ™ndi! v${c} â†’ v${g}`]),x.success(`Son versiyaya mÃ¼vÉ™ffÉ™qiyyÉ™tlÉ™ yenilÉ™ndi! v${c} â†’ v${g}`),await F(),setTimeout(()=>{window.location.reload()},3e3)}else{const r=s.split(`
`).slice(-5).join(`
`);throw new Error(r||"BilinmÉ™yÉ™n xÉ™ta")}}catch(t){d(a=>[...a,"âŒ YenilÉ™mÉ™ xÉ™tasÄ±: "+t.message]),o("error"),n(0),x.error("YenilÉ™mÉ™ uÄŸursuz oldu!")}finally{v(!1)}}};return m.useEffect(()=>{X(),F()},[]),e.jsxs(I,{children:[e.jsx(H,{title:"Sistem YeniliklÉ™ri"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto sm:px-6 lg:px-8",children:[e.jsx(j.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-white/90 dark:bg-gray-800/90 backdrop-blur-lg rounded-2xl shadow-xl p-6 mb-8 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100 flex items-center gap-3",children:[e.jsx(p,{name:"settings",size:32,color:"#10b981"}),"Sistem YenilÉ™mÉ™lÉ™ri"]}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-300",children:"Sistemi yeni versiyaya yenilÉ™yin"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100",children:["Cari Versiya: v",w]}),f&&e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:["Son Versiya: v",f]}),U&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Son yenilÉ™nmÉ™: ",new Date(U).toLocaleDateString("az-AZ",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(j.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"bg-white/90 dark:bg-gray-800/90 backdrop-blur-lg rounded-2xl shadow-xl p-6 border border-gray-200 dark:border-gray-700",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-200 mb-6 flex items-center gap-2",children:[e.jsx(p,{name:"settings",size:20}),"Ä°darÉ™ Paneli"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Sistem Statusu"}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[l==="checking"&&"ğŸ” YoxlanÄ±r...",l==="update-available"&&`ğŸ†• YenilÉ™mÉ™ var${z?` (${z})`:""}`,l==="up-to-date"&&"âœ“ Aktual versiya",l==="updating"&&"âŸ³ YenilÉ™nir...",l==="completed"&&"âœ“ TamamlandÄ±",l==="error"&&"âš ï¸ XÉ™ta",l==="idle"&&"â³ HazÄ±r"]})]}),e.jsx("div",{className:`w-3 h-3 rounded-full ${l==="update-available"?"bg-orange-500 animate-pulse":l==="up-to-date"||l==="completed"?"bg-green-500":l==="updating"||l==="checking"?"bg-blue-500 animate-pulse":l==="error"?"bg-red-500":"bg-gray-400"}`})]}),l==="updating"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{children:"YenilÉ™nmÉ™ tÉ™rÉ™qqÃ¼si"}),e.jsxs("span",{children:[Y,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-600 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"h-3 bg-gradient-to-r from-blue-500 to-green-500 rounded-full transition-all duration-300 ease-out relative",style:{width:`${Y}%`},children:e.jsx("div",{className:"absolute inset-0 bg-white/20 animate-pulse rounded-full"})})}),E[N]&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["AddÄ±m ",N+1,"/",E.length,": ",E[N]]}),D&&e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400",children:["â¬‡ï¸ YÃ¼klÉ™mÉ™ sÃ¼rÉ™ti: ",D]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("button",{onClick:X,disabled:h||l==="checking",className:"w-full py-3 px-4 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:[e.jsx(p,{name:"search",size:16}),l==="checking"?"YoxlanÄ±r...":"YeniliklÉ™ri Yoxla"]}),e.jsxs("button",{onClick:async()=>{if(confirm(`Sistem tÉ™miri baÅŸlayacaq. Migration-lar iÅŸlÉ™dilib, cache tÉ™mizlÉ™nÉ™cÉ™k vÉ™ database strukturu yoxlanÄ±lacaq.

Bu proses 1-3 dÉ™qiqÉ™ Ã§É™kÉ™ bilÉ™r.

Davam etmÉ™k istÉ™yirsiniz?`)){v(!0),o("updating"),d(["ğŸ”§ Sistem tÉ™miri baÅŸlandÄ±..."]),n(0);try{const t=await fetch("/admin/system/fix-and-repair",{method:"POST",headers:{Accept:"text/plain","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),"X-XSRF-TOKEN":q("XSRF-TOKEN")},credentials:"same-origin"});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const a=t.body.getReader(),i=new TextDecoder;let s="";for(;;){const{done:b,value:u}=await a.read();if(b)break;s+=i.decode(u,{stream:!0});const k=s.split(`
`);s=k.pop();for(const r of k)r.trim()&&(d(c=>[...c,r.trim()]),r.includes("Step 1:")?n(10):r.includes("Step 2:")?n(20):r.includes("Step 3:")?n(30):r.includes("Step 4:")?n(40):r.includes("Step 5:")?n(50):r.includes("Step 6:")?n(60):r.includes("Step 7:")?n(70):r.includes("Step 8:")?n(80):r.includes("Step 9:")?n(90):r.includes("REPAIR COMPLETED SUCCESSFULLY")&&(n(100),o("completed"),x.success("Sistem tÉ™miri uÄŸurla tamamlandÄ±!")),r.includes("[[REPAIR_SUCCESS]]")?(o("completed"),x.success("Sistem tÉ™miri uÄŸurla tamamlandÄ±!")):r.includes("[[REPAIR_FAILED]]")&&(o("error"),x.error("Sistem tÉ™miri zamanÄ± xÉ™ta baÅŸ verdi!")))}}catch(t){console.error("System repair error:",t),d(a=>[...a,"âŒ TÉ™mir xÉ™tasÄ±: "+t.message]),o("error"),x.error("Sistem tÉ™miri xÉ™tasÄ±: "+t.message)}finally{v(!1)}}},disabled:h,className:"w-full py-3 px-4 bg-orange-500 hover:bg-orange-600 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:[e.jsx(p,{name:"tools",size:16}),h&&l==="updating"?"TÉ™mir edilir...":"Fiksasiya vÉ™ BÉ™rpa"]}),l==="update-available"&&e.jsxs("button",{onClick:O,disabled:h,className:"w-full py-3 px-4 bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:[e.jsx(p,{name:"download",size:16}),h?"YenilÉ™nir...":`v${f} YenilÉ™`]})]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(p,{name:"warning",size:16,color:"#f59e0b"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"DiqqÉ™t"}),e.jsx("div",{className:"mt-2 text-sm text-yellow-700 dark:text-yellow-300",children:e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"Yenilik prosesi 2-5 dÉ™qiqÉ™ Ã§É™kÉ™ bilÉ™r"}),e.jsx("li",{children:"Bu mÃ¼ddÉ™tdÉ™ sayt É™lÃ§atan olmayacaq"}),e.jsx("li",{children:"Avtomatik backup yaradÄ±lacaq"}),e.jsx("li",{children:"Brauzer sÉ™hifÉ™sini baÄŸlamayÄ±n"})]})})]})]})})]})]}),e.jsxs(j.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"bg-white/90 dark:bg-gray-800/90 backdrop-blur-lg rounded-2xl shadow-xl p-6 border border-gray-200 dark:border-gray-700",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(p,{name:"copy",size:20}),"Proses Logu"]}),e.jsx("div",{className:"bg-gray-900 rounded-lg p-4 h-80 overflow-y-auto",children:e.jsx("div",{className:"font-mono text-sm space-y-1",children:L.length===0?e.jsx("div",{className:"text-gray-400",children:"Yenilik logu burada gÃ¶rÃ¼nÉ™cÉ™k..."}):L.map((t,a)=>e.jsx("div",{className:"text-green-400",children:t},a))})})]}),e.jsxs(j.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"bg-white/90 dark:bg-gray-800/90 backdrop-blur-lg rounded-2xl shadow-xl p-6 border border-gray-200 dark:border-gray-700",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2",children:[e.jsx(p,{name:"history",size:20}),"YenilÉ™mÉ™ Tarixi"]}),T.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsxs("div",{className:"text-gray-400 dark:text-gray-500 mb-2",children:[e.jsx(p,{name:"history",size:48,className:"mx-auto mb-3 opacity-50"}),"HÉ™lÉ™ heÃ§ bir yenilÉ™mÉ™ qeydi tapÄ±lmadÄ±"]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Ä°lk yenilÉ™mÉ™dÉ™n sonra tarix burada gÃ¶rÃ¼nÉ™cÉ™k"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:["Ãœmumi ",T.length," qeyd"]}),e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600",children:T.map((t,a)=>e.jsxs("div",{className:"p-4 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-white text-xs font-medium ${t.status==="success"?"bg-green-500":"bg-red-500"}`,children:t.status==="success"?"âœ“ UÄŸurlu":"âœ— UÄŸursuz"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:["v",t.version_from||"?"," â†’ v",t.version_to||"?"]})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(t.created_at).toLocaleString("az-AZ",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),t.message&&e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:t.message}),t.release_notes&&e.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 p-2 rounded",children:["ğŸ“ ",t.release_notes.slice(0,100),"..."]})]},t.id))})]})]})]})]})})]})};export{le as default};
