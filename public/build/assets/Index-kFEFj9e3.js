import{j as e,M as yt,r as bt,a as kt}from"./markdown-BUCLRvA3.js";import{a as s,L,H as jt,b as W}from"./vendor-BlctNO3C.js";import{I as c}from"./Icon-CILp3_L4.js";import{a as fe,u as wt}from"./app-B4Kmtg8h.js";import{F as vt}from"./Footer-Z5PVxi4B.js";import{M as Nt,i as _t,u as Ue,P as St,a as Ct,b as zt,L as Mt,m as z}from"./proxy-lxAKZ2WZ.js";import{r as Dt}from"./index-DMt_lOXb.js";import"./app-B0iARrZD.js";function Je(a,l){if(typeof a=="function")return a(l);a!=null&&(a.current=l)}function It(...a){return l=>{let r=!1;const p=a.map(m=>{const o=Je(m,l);return!r&&typeof o=="function"&&(r=!0),o});if(r)return()=>{for(let m=0;m<p.length;m++){const o=p[m];typeof o=="function"?o():Je(a[m],null)}}}}function Tt(...a){return s.useCallback(It(...a),a)}class $t extends s.Component{getSnapshotBeforeUpdate(l){const r=this.props.childRef.current;if(r&&l.isPresent&&!this.props.isPresent){const p=r.offsetParent,m=_t(p)&&p.offsetWidth||0,o=this.props.sizeRef.current;o.height=r.offsetHeight||0,o.width=r.offsetWidth||0,o.top=r.offsetTop,o.left=r.offsetLeft,o.right=m-o.width-o.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Lt({children:a,isPresent:l,anchorX:r,root:p}){const m=s.useId(),o=s.useRef(null),_=s.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:N}=s.useContext(Nt),S=Tt(o,a?.ref);return s.useInsertionEffect(()=>{const{width:f,height:y,top:u,left:h,right:g}=_.current;if(l||!o.current||!f||!y)return;const w=r==="left"?`left: ${h}`:`right: ${g}`;o.current.dataset.motionPopId=m;const b=document.createElement("style");N&&(b.nonce=N);const E=p??document.head;return E.appendChild(b),b.sheet&&b.sheet.insertRule(`
          [data-motion-pop-id="${m}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${y}px !important;
            ${w}px !important;
            top: ${u}px !important;
          }
        `),()=>{E.contains(b)&&E.removeChild(b)}},[l]),e.jsx($t,{isPresent:l,childRef:o,sizeRef:_,children:s.cloneElement(a,{ref:S})})}const Et=({children:a,initial:l,isPresent:r,onExitComplete:p,custom:m,presenceAffectsLayout:o,mode:_,anchorX:N,root:S})=>{const f=Ue(Ft),y=s.useId();let u=!0,h=s.useMemo(()=>(u=!1,{id:y,initial:l,isPresent:r,custom:m,onExitComplete:g=>{f.set(g,!0);for(const w of f.values())if(!w)return;p&&p()},register:g=>(f.set(g,!1),()=>f.delete(g))}),[r,f,p]);return o&&u&&(h={...h}),s.useMemo(()=>{f.forEach((g,w)=>f.set(w,!1))},[r]),s.useEffect(()=>{!r&&!f.size&&p&&p()},[r]),_==="popLayout"&&(a=e.jsx(Lt,{isPresent:r,anchorX:N,root:S,children:a})),e.jsx(St.Provider,{value:h,children:a})};function Ft(){return new Map}const pe=a=>a.key||"";function Ke(a){const l=[];return s.Children.forEach(a,r=>{s.isValidElement(r)&&l.push(r)}),l}const ye=({children:a,custom:l,initial:r=!0,onExitComplete:p,presenceAffectsLayout:m=!0,mode:o="sync",propagate:_=!1,anchorX:N="left",root:S})=>{const[f,y]=Ct(_),u=s.useMemo(()=>Ke(a),[a]),h=_&&!f?[]:u.map(pe),g=s.useRef(!0),w=s.useRef(u),b=Ue(()=>new Map),[E,de]=s.useState(u),[M,J]=s.useState(u);zt(()=>{g.current=!1,w.current=u;for(let C=0;C<M.length;C++){const v=pe(M[C]);h.includes(v)?b.delete(v):b.get(v)!==!0&&b.set(v,!1)}},[M,h.length,h.join("-")]);const U=[];if(u!==E){let C=[...u];for(let v=0;v<M.length;v++){const R=M[v],P=pe(R);h.includes(P)||(C.splice(v,0,R),U.push(R))}return o==="wait"&&U.length&&(C=U),J(Ke(C)),de(u),null}const{forceRender:Y}=s.useContext(Mt);return e.jsx(e.Fragment,{children:M.map(C=>{const v=pe(C),R=_&&!f?!1:u===M||h.includes(v),P=()=>{if(b.has(v))b.set(v,!0);else return;let G=!0;b.forEach(be=>{be||(G=!1)}),G&&(Y?.(),J(w.current),_&&y?.(),p&&p())};return e.jsx(Et,{isPresent:R,initial:!g.current||r?void 0:!1,custom:l,presenceAffectsLayout:m,mode:o,root:S,onExitComplete:R?void 0:P,anchorX:N,children:C},v)})})},Rt=({className:a=""})=>{const{isDarkMode:l}=fe(),[r,p]=s.useState(null),[m,o]=s.useState(!0),[_,N]=s.useState(!1),[S,f]=s.useState(!1);s.useEffect(()=>{const g=localStorage.getItem("donation_dismissed_until"),w=Date.now();if(g&&w<parseInt(g)){f(!0),o(!1);return}y()},[]);const y=async()=>{try{const w=await(await fetch("/api/donation-settings")).json();w&&w.enabled&&(p(w),setTimeout(()=>{N(!0)},2e3))}catch(g){console.error("Error fetching donation settings:",g)}finally{o(!1)}},u=()=>{f(!0),N(!1)},h=()=>{const g=Date.now()+6048e5;localStorage.setItem("donation_dismissed_until",g.toString()),f(!0),N(!1)};return m||!r||S?null:e.jsx(ye,{children:_&&e.jsx(z.div,{className:"fixed inset-0 backdrop-blur-lg flex items-center justify-center z-50 p-4 modal-overlay",style:{background:l?"linear-gradient(135deg, rgba(31, 41, 55, 0.85) 0%, rgba(17, 24, 39, 0.9) 100%) !important":"linear-gradient(135deg, rgba(249, 250, 251, 0.85) 0%, rgba(255, 255, 255, 0.9) 100%) !important"},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},onClick:()=>N(!1),children:e.jsxs(z.div,{className:`max-w-md w-full rounded-3xl shadow-2xl relative overflow-hidden border-2 backdrop-blur-md modal-content donation-modal ${l?"dark":""} ${l?"border-gray-600/50":"border-gray-200/50"}`,style:{background:r.background_color||(l?"linear-gradient(135deg, rgba(31, 41, 55, 0.95) 0%, rgba(17, 24, 39, 0.98) 100%) !important":"linear-gradient(135deg, rgba(249, 250, 251, 0.95) 0%, rgba(255, 255, 255, 0.98) 100%) !important"),color:r.text_color||(l?"#ffffff !important":"#333333 !important"),backdropFilter:"blur(20px)",boxShadow:l?"0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05)":"0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.1)"},initial:{scale:.8,opacity:0,y:50,rotateX:15},animate:{scale:1,opacity:1,y:0,rotateX:0},exit:{scale:.8,opacity:0,y:50,rotateX:15},transition:{type:"spring",damping:25,stiffness:300,duration:.5},whileHover:{scale:1.02,y:-5},onClick:g=>g.stopPropagation(),children:[e.jsx(z.button,{onClick:u,className:`absolute top-5 right-5 w-10 h-10 flex items-center justify-center rounded-full transition-all duration-300 z-10 text-xl font-medium ${l?"bg-gray-700/70 hover:bg-gray-600/80 text-gray-300 hover:text-white border border-gray-600/50":"bg-gray-100/70 hover:bg-gray-200/80 text-gray-600 hover:text-gray-800 border border-gray-200/50"}`,whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},children:"√ó"}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(z.h3,{className:"text-2xl font-bold mb-6 pr-10 leading-tight",style:{color:r.text_color||(l?"#ffffff":"#333333")},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:r.title}),e.jsx(z.div,{className:`text-base leading-relaxed prose max-w-none ${l?"dark:prose-invert":""}`,style:{color:r.text_color||(l?"#ffffff":"#333333"),"--tw-prose-body":r.text_color||(l?"#ffffff":"#333333"),"--tw-prose-headings":r.text_color||(l?"#ffffff":"#333333"),"--tw-prose-bold":r.text_color||(l?"#ffffff":"#333333"),"--tw-prose-links":r.text_color||(l?"#ffffff":"#333333")},dangerouslySetInnerHTML:{__html:r.content},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2}})]}),e.jsxs(z.div,{className:"space-y-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx(z.div,{className:"flex-1",children:e.jsx(L,{href:"/donation",className:"w-full block px-6 py-4 rounded-xl font-bold text-white text-center transition-all duration-300 shadow-lg",style:{backgroundColor:r.button_color||"#3b82f6"},onMouseEnter:g=>{g.target.style.filter="brightness(110%)",g.target.style.transform="translateY(-2px)",g.target.style.boxShadow="0 20px 40px rgba(0,0,0,0.2)"},onMouseLeave:g=>{g.target.style.filter="brightness(100%)",g.target.style.transform="translateY(0px)",g.target.style.boxShadow="0 10px 25px rgba(0,0,0,0.1)"},children:"üíù D…ôst…ôk Ol"})}),e.jsx(z.button,{className:`px-6 py-4 rounded-xl font-medium transition-all duration-300 hover:shadow-md backdrop-blur-sm ${l?"text-gray-300 border border-gray-600/60 hover:bg-gray-700/60 hover:border-gray-500":"text-gray-600 border border-gray-300/60 hover:bg-gray-50/60 hover:border-gray-400"}`,onClick:u,whileHover:{scale:1.05},whileTap:{scale:.95},children:"Baƒüla"})]}),e.jsx(z.button,{className:`w-full text-sm underline transition-colors py-2 rounded-lg ${l?"text-gray-400 hover:text-gray-200 hover:bg-gray-700/30":"text-gray-500 hover:text-gray-700 hover:bg-gray-100/30"}`,onClick:h,whileHover:{scale:1.02},children:"1 h…ôft…ô g√∂st…ôrm…ô"})]})]})]})})})},At=({isOpen:a,onAccept:l,onReject:r,siteName:p="XIV AI"})=>{const{theme:m}=fe(),[o,_]=s.useState(!1),[N,S]=s.useState(null),[f,y]=s.useState(!0),u=async()=>{try{const g=await(await fetch("/api/guest-terms")).json();S(g)}catch{console.warn("Failed to fetch admin terms, using fallback"),S({title:"ƒ∞stifad…ô ≈û…ôrtl…ôri",content:"<p>ƒ∞stifad…ô ≈ü…ôrtl…ôri y√ºkl…ônm…ôdi.</p>"})}finally{y(!1)}};return s.useEffect(()=>{a&&!N&&u()},[a]),s.useEffect(()=>(a?(_(!0),document.body.style.overflow="hidden"):document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[a]),a?e.jsx(ye,{children:o&&e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:[e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"absolute inset-0 bg-black/70 backdrop-blur-md",onClick:()=>r&&r()}),e.jsxs(z.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{duration:.3,type:"spring",stiffness:300,damping:25},className:"relative z-50 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-lg w-full mx-4 max-h-[90vh] overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"p-6 text-white",style:{background:m?.primary_color?`linear-gradient(135deg, ${m.primary_color} 0%, ${m.secondary_color||m.primary_color} 100%)`:"linear-gradient(135deg, #10b981 0%, #065f46 100%)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(c,{name:"shield_check",size:24,color:"white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:f?"ƒ∞stifad…ô ≈û…ôrtl…ôri":N?.title||"ƒ∞stifad…ô ≈û…ôrtl…ôri"}),e.jsx("p",{className:"text-blue-100 text-sm",children:p})]})]})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-96",children:f?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Y√ºkl…ônir..."})]}):e.jsx("div",{className:"text-gray-700 dark:text-gray-300 text-sm leading-relaxed",children:e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:N?.content||"<p>ƒ∞stifad…ô ≈ü…ôrtl…ôri y√ºkl…ônm…ôdi.</p>"}})})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 dark:border-gray-600 flex gap-3",style:{background:m?.primary_color?`linear-gradient(135deg, ${m.primary_color}15 0%, ${m.secondary_color||m.primary_color}15 100%)`:"linear-gradient(135deg, #10b98115 0%, #065f4615 100%)"},children:[e.jsxs("button",{onClick:r,className:"flex-1 px-4 py-3 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-medium hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors flex items-center justify-center gap-2",children:[e.jsx(c,{name:"close",size:16}),e.jsx("span",{children:"R…ôdd et"})]}),e.jsxs("button",{onClick:l,className:"flex-1 px-4 py-3 text-white rounded-lg font-medium transition-all flex items-center justify-center gap-2 shadow-lg hover:shadow-xl",style:{background:m?.primary_color?`linear-gradient(135deg, ${m.primary_color} 0%, ${m.secondary_color||m.primary_color} 100%)`:"linear-gradient(135deg, #10b981 0%, #065f46 100%)",filter:"brightness(1)",":hover":{filter:"brightness(1.1)"}},onMouseEnter:h=>h.target.style.filter="brightness(1.1)",onMouseLeave:h=>h.target.style.filter="brightness(1)",children:[e.jsx(c,{name:"shield_check",size:16}),e.jsx("span",{children:"Q…ôbul edir…ôm"})]})]})]})]})}):null},qt=({isOpen:a,onConfirm:l,onCancel:r,chatTitle:p="",siteName:m=""})=>{const{theme:o}=fe();return a?e.jsx(ye,{children:e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",children:[e.jsx(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"absolute inset-0 bg-black/70 backdrop-blur-md",onClick:r}),e.jsxs(z.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{duration:.3,type:"spring",stiffness:300,damping:25},className:"relative z-50 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"p-6 text-white",style:{background:o?.primary_color?`linear-gradient(135deg, ${o.primary_color} 0%, ${o.secondary_color||o.primary_color} 100%)`:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(c,{name:"warning",size:24,color:"white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"S√∂hb…ôti Sil"}),e.jsx("p",{className:"text-blue-100 text-sm",children:m})]})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-gray-700 dark:text-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center",children:e.jsx(c,{name:"warning",size:24,color:"#ef4444"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-gray-100",children:"Bu s√∂hb…ôti silm…ôk ist…ôdiyinizd…ôn …ôminsiz?"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Bu …ôm…ôl geri alƒ±na bilm…ôz."})]})]}),p&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Silin…ôc…ôk s√∂hb…ôt:"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:['"',p,'"']})]})]})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 dark:border-gray-600 flex gap-3",style:{background:o?.primary_color?`linear-gradient(135deg, ${o.primary_color}10 0%, ${o.secondary_color||o.primary_color}10 100%)`:"linear-gradient(135deg, #ef444415 0%, #dc262615 100%)"},children:[e.jsxs("button",{onClick:r,className:"flex-1 px-4 py-3 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-medium hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors flex items-center justify-center gap-2",children:[e.jsx(c,{name:"close",size:16}),e.jsx("span",{children:"L…ôƒüv et"})]}),e.jsxs("button",{onClick:l,className:"flex-1 px-4 py-3 text-white rounded-lg font-medium transition-all flex items-center justify-center gap-2 shadow-lg hover:shadow-xl bg-red-500 hover:bg-red-600",children:[e.jsx(c,{name:"delete",size:16}),e.jsx("span",{children:"Sil"})]})]})]})]})}):null},Pt=({className:a="",chatbotName:l="AI Assistant"})=>e.jsxs("div",{className:`flex items-center space-x-1 ${a}`,children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400 mr-2",children:l}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]}),Gt=({text:a,speed:l=50,onComplete:r})=>{const[p,m]=s.useState(""),[o,_]=s.useState(0);return s.useEffect(()=>{m(""),_(0)},[a]),s.useEffect(()=>{if(o<a.length){const N=setTimeout(()=>{m(S=>S+a[o]),_(S=>S+1)},l);return()=>clearTimeout(N)}else o===a.length&&o>0&&r&&r()},[o,a,l,r]),e.jsx("span",{children:p})},Ht=({content:a})=>e.jsx(yt,{remarkPlugins:[kt],rehypePlugins:[bt],components:{h1:({node:l,...r})=>e.jsx("h1",{className:"text-2xl font-bold mb-1 text-gray-800 dark:text-gray-100",...r}),h2:({node:l,...r})=>e.jsx("h2",{className:"text-xl font-semibold mb-1 text-gray-800 dark:text-gray-100",...r}),h3:({node:l,...r})=>e.jsx("h3",{className:"text-lg font-medium mb-1 text-gray-700 dark:text-gray-200",...r}),h4:({node:l,...r})=>e.jsx("h4",{className:"text-base font-medium mb-1 text-gray-700 dark:text-gray-200",...r}),p:({node:l,...r})=>e.jsx("p",{className:"mb-1 leading-normal text-gray-800 dark:text-gray-200",...r}),strong:({node:l,...r})=>e.jsx("strong",{className:"font-bold text-gray-900 dark:text-gray-100",...r}),em:({node:l,...r})=>e.jsx("em",{className:"italic text-gray-800 dark:text-gray-200",...r}),ul:({node:l,...r})=>e.jsx("ul",{className:"list-disc list-inside mb-1 space-y-0.5 text-gray-800 dark:text-gray-200",...r}),ol:({node:l,...r})=>e.jsx("ol",{className:"list-decimal list-inside mb-1 space-y-0.5 text-gray-800 dark:text-gray-200",...r}),li:({node:l,...r})=>e.jsx("li",{className:"text-gray-800 dark:text-gray-200",...r}),blockquote:({node:l,...r})=>e.jsx("blockquote",{className:"border-l-4 border-emerald-400 pl-4 py-1 mb-1 bg-emerald-50 dark:bg-emerald-900/30 text-gray-700 dark:text-gray-300",...r}),code:({node:l,inline:r,...p})=>r?e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 py-0.5 rounded text-sm font-mono text-gray-800 dark:text-gray-200",...p}):e.jsx("code",{className:"block bg-gray-100 dark:bg-gray-700 p-3 rounded-lg text-sm font-mono text-gray-800 dark:text-gray-200 overflow-x-auto",...p}),a:({node:l,...r})=>e.jsx("a",{className:"text-emerald-600 dark:text-emerald-400 hover:text-emerald-700 dark:hover:text-emerald-300 underline",target:"_blank",rel:"noopener noreferrer",...r})},children:a});function Qt({auth:a,sessions:l=[],settings:r={},theme:p={},footerSettings:m={}}){const o=wt(),{theme:_,isDarkMode:N,toggleDarkMode:S,refreshTheme:f}=fe(),y=_||p,u={...y,isDarkMode:N,toggleDarkMode:S},[h,g]=s.useState(null),[w,b]=s.useState([]),[E,de]=s.useState(""),[M,J]=s.useState(!1),[U,Y]=s.useState(!1),[C,v]=s.useState([]),[R,P]=s.useState(l||[]);s.useEffect(()=>{P(l||[])},[JSON.stringify(l)]);const[G,be]=s.useState(!0),[Ye,ke]=s.useState(new Set),[D,V]=s.useState(!1),[je,ce]=s.useState(!1),[Ee,we]=s.useState(null),[B,Ve]=s.useState(new Map),[Ze,me]=s.useState(!1),ve=s.useRef(null),[Fe,Qe]=s.useState({top:0,left:0,align:"left"}),Re=t=>{try{const n=t.getBoundingClientRect(),i=8,d=window.innerWidth,x=n.right+320<d,k=x?Math.max(8,n.left):Math.max(8,n.right-320),j=Math.min(window.innerHeight-200,n.bottom+i);Qe({top:j,left:k,align:x?"left":"right"})}catch{}},[Ae,et]=s.useState(()=>{try{const t=localStorage.getItem("feedbackGiven"),n=t?JSON.parse(t):[];return new Set(n.map(String))}catch{return new Set}}),tt=t=>{try{const n=new Set(Ae);n.add(String(t)),et(n),localStorage.setItem("feedbackGiven",JSON.stringify([...n]))}catch{}},T=s.useRef(null),Z=s.useRef(null),[rt,Ne]=s.useState(!1),[st,_e]=s.useState(!1),[F,H]=s.useState(!0),[at,Se]=s.useState(!1),[A,Ce]=s.useState(null),[q,ge]=s.useState(()=>{const t=Number(localStorage.getItem("messageFontScale"));return t&&t>=.85&&t<=1.4?t:1}),[nt,it]=s.useState(!1),[ze,xe]=s.useState(new Map),[qe,ot]=s.useState(null);s.useEffect(()=>{try{localStorage.setItem("messageFontScale",String(q))}catch{}},[q]);const lt=async()=>{if(A)try{if(a?.user){const t=document.querySelector('meta[name="csrf-token"]').getAttribute("content");try{await W.delete(`/chat/${A.session_id}`,{headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}})}catch{await W.post(`/chat/${A.session_id}/delete`,{},{headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}})}P(n=>n.filter(i=>i.session_id!==A.session_id)),h===A.session_id&&(g(null),b([]))}else{const n=JSON.parse(localStorage.getItem("guestChatSessions")||"[]").filter(i=>i.session_id!==A.session_id);localStorage.setItem("guestChatSessions",JSON.stringify(n)),v(n),h===A.session_id&&(g(null),b([]))}o.success("S√∂hb…ôt silindi!")}catch(t){console.error("Delete session error:",t),o.error("S√∂hb…ôt silin…ôrk…ôn x…ôta ba≈ü verdi")}finally{Se(!1),Ce(null)}},dt=()=>{Se(!1),Ce(null)},[I,Me]=s.useState({allowed:!0,remaining:0,daily_remaining:0,monthly_remaining:0,reset_time:null,monthly_reset_time:null,user_type:"guest"}),[Q,De]=s.useState(!1),[ee,Ie]=s.useState(null),Pe=r.chatbot_name||"AI Assistant",te=r.site_name||"XIV AI Chatbot Platform",ct=r.chat_disclaimer_text||"√áatbotun cavablarƒ±nƒ± yoxlayƒ±n, s…ôhv ed…ô bil…ôr!",O=Number(r.message_input_limit||r.guest_input_limit||500),Ge=r.ai_response_type||"typewriter",mt=Number(r.ai_typing_speed||50),gt=Number(r.ai_thinking_time||1e3),ue=!a?.user,re=E.length,xt=O-re,X=O>0&&re>O,$=y?.primary_color,Te=y?.secondary_color;y?.accent_color,y?.background_gradient;const he=(()=>{const t=typeof window<"u"?window.innerWidth<768:!1,n=u.isDarkMode,i=r||{},d=i.brand_logo_desktop_light,x=i.brand_logo_desktop_dark,k=i.brand_logo_mobile_light,j=i.brand_logo_mobile_dark;if(t){if(n&&j)return j;if(!n&&k)return k}else{if(n&&x)return x;if(!n&&d)return d}return i.brand_logo_url||""})(),$e=(()=>{const t=y?.chat_background_type;if(!t||t==="default"||t===null)return"transparent";switch(t){case"solid":return y?.chat_background_color||"transparent";case"gradient":return y?.chat_background_gradient||"transparent";case"image":return y?.chat_background_image?`url(${y.chat_background_image})`:"transparent";default:return"transparent"}})(),He=t=>{if(!t)return"";const i=t-new Date;if(i<=0)return"Yenil…ônir...";const d=Math.floor(i/(1e3*60*60)),x=Math.floor(i%(1e3*60*60)/(1e3*60)),k=Math.floor(i%(1e3*60)/1e3);return d>0?`${d} saat ${x} d…ôqiq…ô ${k} saniy…ô`:x>0?`${x} d…ôqiq…ô ${k} saniy…ô`:`${k} saniy…ô`},se=async()=>{try{const n=await(await fetch(`/api/chat-limits?t=${Date.now()}`,{cache:"no-store"})).json();Me(n),n.allowed?(De(!1),(st||a?.user)&&H(!1)):(De(!0),H(!0),n.reset_time&&Ie(new Date(n.reset_time)))}catch(t){console.error("Failed to fetch limits:",t)}};s.useEffect(()=>{if(a?.user)H(!1),_e(!0);else{const t=JSON.parse(localStorage.getItem("guestChatSessions")||"[]");v(t),localStorage.getItem("guest-terms-accepted")==="true"?(_e(!0),H(!1)):(Ne(!0),H(!0))}se()},[a?.user]),s.useEffect(()=>{se();const t=setInterval(se,3e4),n=setInterval(()=>{ee&&ee-new Date<=0&&(se(),Ie(null))},1e3);return()=>{clearInterval(t),clearInterval(n)}},[ee]),s.useEffect(()=>{const t=()=>{f&&f(),se()};return window.addEventListener("focus",t),()=>window.removeEventListener("focus",t)},[f]);const Be=(t,n,i)=>{if(!a?.user){const d={session_id:t,title:n||t.slice(0,8),messages:i||[],created_at:new Date().toISOString()},x=JSON.parse(localStorage.getItem("guestChatSessions")||"[]"),k=x.findIndex(K=>K.session_id===t);k>=0?x[k]={...x[k],messages:i}:x.unshift(d);const j=x.slice(0,10);localStorage.setItem("guestChatSessions",JSON.stringify(j)),v(j)}},ut=async t=>{if(a?.user)try{const{data:n}=await W.get(`/chat/${t}`);b(n.messages)}catch(n){o.error("S√∂hb…ôt y√ºkl…ônm…ôdi"),console.error("loadSession error:",n)}else{const n=C.find(i=>i.session_id===t);n&&b(n.messages||[])}g(t)},ht=()=>{localStorage.setItem("guest-terms-accepted","true"),_e(!0),Q||H(!1),Ne(!1),o.success("ƒ∞stifad…ô ≈ü…ôrtl…ôri q…ôbul edildi! ƒ∞ndi √ßatbotla danƒ±≈üa bil…ôrsiniz.")},pt=()=>{Ne(!1),H(!0),o.warning("ƒ∞stifad…ô ≈ü…ôrtl…ôrini q…ôbul etm…ôd…ôn √ßatbotla danƒ±≈üa bilm…ôzsiniz.")},Oe=async()=>{if(!E.trim())return;if(D){o.warning("√áatbot h…ôl…ô d…ô yazƒ±r. Z…ôhm…ôt olmasa g√∂zl…ôyin.");return}if(F){o.warning("ƒ∞stifad…ô ≈ü…ôrtl…ôrini q…ôbul etm…ôd…ôn mesaj g√∂nd…ôr…ô bilm…ôzsiniz.");return}if(X){o.warning(`Daxiletm…ô limiti: ${O}. Cari: ${re} simvol`);return}const t={role:"user",content:E,created_at:new Date().toISOString()};b(i=>[...i,{...t,id:`local-${Date.now()}`}]),de("");try{Z.current&&(Z.current.style.height="")}catch{}J(!0),Y(!0);const n=new AbortController;we(n);try{const{data:i}=await W.post("/chat/send",{message:t.content,session_id:h},{signal:n.signal});if(!h){g(i.session_id);const j=t.content.slice(0,40),K=new Date().toISOString();if(a?.user){P(ie=>[{session_id:i.session_id,title:"",created_at:K},...ie]);let ae=0;const ne=setInterval(()=>{ae++;const ie=j.slice(0,ae);P(oe=>oe.map(le=>le.session_id===i.session_id?{...le,title:ie}:le)),ae>=j.length&&clearInterval(ne)},Math.max(20,Math.min(80,1e3/Math.max(5,j.length))))}else{const ae={session_id:i.session_id,title:"",created_at:K,messages:[t]};v(oe=>[ae,...oe]);let ne=0;const ie=setInterval(()=>{ne++;const oe=j.slice(0,ne);v(le=>le.map(Le=>Le.session_id===i.session_id?{...Le,title:oe}:Le)),ne>=j.length&&clearInterval(ie)},Math.max(20,Math.min(80,1e3/Math.max(5,j.length))))}}const d=`ai-${Date.now()}`;let x;if(Ge==="instant"){x={role:"assistant",content:i.message,fullContent:i.message,id:d,created_at:new Date().toISOString(),isTyping:!1};const j=[...w,t,x];b(K=>[...K,x])}else x={role:"assistant",content:"",fullContent:i.message,id:d,created_at:new Date().toISOString(),isTyping:!0},b(j=>[...j,x]),V(!0),setTimeout(()=>{ke(j=>new Set([...j,d]))},gt);const k=[...w,t,x];if(!a?.user){const j=h||i.session_id;Be(j,t.content,k)}i.limit_info&&Me({allowed:i.limit_info.remaining>0,remaining:i.limit_info.remaining,daily_remaining:i.limit_info.daily_remaining,monthly_remaining:i.limit_info.monthly_remaining,reset_time:i.limit_info.reset_time,monthly_reset_time:i.limit_info.monthly_reset_time,user_type:a?.user?"user":"guest"})}catch(i){if(i.name==="CanceledError")o.info("Mesaj g√∂nd…ôrm…ô dayandƒ±rƒ±ldƒ±");else if(i.response?.status===429){const d=i.response.data;o.error(d.error||"Mesaj limiti dolmu≈üdur!"),d.limit_exceeded&&(De(!0),H(!0),d.reset_time&&Ie(new Date(d.reset_time)),Me({allowed:!1,remaining:d.remaining||0,daily_remaining:d.daily_remaining||0,monthly_remaining:d.monthly_remaining||0,reset_time:d.reset_time,monthly_reset_time:d.monthly_reset_time,user_type:a?.user?"user":"guest"}))}else o.error(i.response?.data?.error||"X…ôta ba≈ü verdi");V(!1)}finally{J(!1),we(null),setTimeout(()=>{Y(!1),Ge==="instant"&&V(!1)},600),setTimeout(()=>T.current?.scrollTo({top:T.current.scrollHeight,behavior:"smooth"}),50)}},Xe=async()=>{Ee&&(Ee.abort(),we(null));try{await W.post("/chat/stop")}catch{}J(!1),Y(!1),V(!1),ke(new Set),o.info("Cavab yazmaq dayandƒ±rƒ±ldƒ±")},We=async(t,n,i)=>{tt(t);try{Ve(x=>{const k=new Map(x);return k.set(t,i),k}),await W.post("/chat/feedback",{message_id:t,session_id:h,message_content:n,feedback_type:i});const d=i==="like"?"R…ôyiniz √º√ß√ºn t…ô≈ü…ôkk√ºr edirik, bu bizi sevindirir. :)":"R…ôyiniz √º√ß√ºn t…ô≈ü…ôkk√ºr edirik, biz √ßatbotu t…ôkmil…ô≈üdir…ôc…ôyik, z…ôif t…ôcr√ºb…ômiz √º√ß√ºn √ºzr ist…ôyirik.";o.success(d)}catch(d){console.error("Feedback error:",d);const x=d?.response?.data?.error||"B…ôy…ôn/B…ôy…ônm…ô g√∂nd…ôrilm…ôdi";o.error(x)}},ft=t=>{t.key==="Enter"&&G&&!t.shiftKey&&(t.preventDefault(),M||D?Xe():!F&&!D&&Oe())};return s.useEffect(()=>{T.current&&(T.current.scrollTop=T.current.scrollHeight)},[w]),s.useEffect(()=>{T.current&&T.current.scrollTo({top:T.current.scrollHeight,behavior:"smooth"})},[w]),s.useEffect(()=>{if(T.current&&D){const t=setInterval(()=>{try{const n=T.current;n.scrollTop=n.scrollHeight}catch{}},150);return()=>clearInterval(t)}},[D,w]),s.useEffect(()=>{const t=n=>{ve.current&&!ve.current.contains(n.target)&&me(!1)};return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[]),e.jsx("div",{className:`${u.isDarkMode?"dark":""}`,children:e.jsxs("div",{className:"min-h-screen flex flex-col overflow-x-hidden",style:{background:u.isDarkMode?"linear-gradient(135deg, #1f2937 0%, #111827 100%)":y?.background_gradient||"linear-gradient(135deg, #f9fafb 0%, #ffffff 100%)",backgroundAttachment:"fixed"},children:[e.jsx(jt,{title:`∆èsas s…ôhif…ô - ${te}`}),e.jsxs("div",{className:"w-full px-4 md:px-4 lg:px-6 py-4 md:py-4 lg:py-6 flex-1 pb-0",children:[e.jsxs("header",{className:"mb-4 md:mb-6 flex flex-wrap items-center justify-between bg-white/90 dark:bg-gray-800/90 backdrop-blur-lg rounded-2xl p-3 md:p-4 shadow-xl w-full",children:[e.jsxs("div",{className:"flex items-start md:items-center gap-2",children:[e.jsx("button",{onClick:()=>ce(!je),className:"md:hidden p-2 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":"S√∂hb…ôt tarix√ß…ôsi",children:e.jsx(c,{name:"menu",size:20})}),e.jsxs("h1",{className:"hidden md:flex text-lg md:text-2xl lg:text-3xl font-semibold text-gray-800 dark:text-gray-100 items-center gap-2",children:[r.brand_mode==="logo"&&(he||r.brand_logo_url)?e.jsx("img",{src:he||r.brand_logo_url,alt:"logo",className:"w-6 h-6 md:w-8 md:h-8 object-contain rounded"}):r.brand_mode==="icon"?e.jsx(c,{name:r.brand_icon_name||"nav_chat",size:24,className:"md:w-8 md:h-8",color:$}):null,e.jsx("span",{className:"truncate",children:te})]}),e.jsxs("div",{className:"md:hidden flex flex-col gap-1 ml-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[12px] font-medium text-gray-700 dark:text-gray-300",ref:ve,children:[e.jsx(c,{name:"limit",size:18}),e.jsxs("span",{children:[I.limit_type==="monthly"?"Aylƒ±q":"G√ºnl√ºk"," limitiniz"]}),e.jsx("span",{className:"text-white px-2 py-0.5 rounded-full",style:{backgroundColor:$},children:I.remaining})," sorƒüu",e.jsx("button",{type:"button",onClick:t=>{t.stopPropagation(),Re(t.currentTarget),me(n=>!n)},className:"ml-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",title:"Limit haqqƒ±nda",children:e.jsx(c,{name:"limit_info",size:18})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{name:"sun",size:16,color:u.isDarkMode?"#9ca3af":"#fbbf24"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u.isDarkMode,onChange:()=>u.toggleDarkMode(),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]}),e.jsx(c,{name:"moon",size:16,color:u.isDarkMode?"#60a5fa":"#9ca3af"})]})]})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-2 flex-wrap justify-end",children:[e.jsx("div",{className:`relative px-2 py-1 rounded-lg text-xs font-medium ${Q?"bg-red-100 text-red-800 border border-red-200":I.remaining<=5?"bg-yellow-100 text-yellow-800 border border-yellow-200":"bg-green-100 text-green-800 border border-green-200"}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{name:Q?"warning":"limit",size:12}),e.jsx("span",{children:Q?e.jsxs(e.Fragment,{children:["M…ôhdudiyy…ôt! - ",He(ee)]}):e.jsxs(e.Fragment,{children:[I.limit_type==="monthly"?"Aylƒ±q":"G√ºnl√ºk"," limitiniz ",I.remaining," sorƒüu(√ßƒ±xƒ±≈ü)"]})}),e.jsx("button",{type:"button",onClick:t=>{t.stopPropagation(),Re(t.currentTarget),me(n=>!n)},className:"ml-1 text-gray-600 hover:text-gray-800 dark:text-gray-300 dark:hover:text-gray-100",title:"Limit haqqƒ±nda",children:e.jsx(c,{name:"limit_info",size:18})})]})}),e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[e.jsx(c,{name:"sun",size:16,color:u.isDarkMode?"#9ca3af":"#fbbf24"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u.isDarkMode,onChange:()=>u.toggleDarkMode(),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]}),e.jsx(c,{name:"moon",size:16,color:u.isDarkMode?"#60a5fa":"#9ca3af"})]}),a?.user?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"hidden md:inline text-sm text-gray-600 dark:text-gray-300",children:["Salam, ",a.user.name]}),a.user.role?.name==="admin"&&e.jsxs(L,{href:"/admin",className:"px-2 md:px-3 py-2 rounded-lg text-sm bg-purple-600 text-white hover:bg-purple-700 transition-colors shadow-sm flex items-center gap-1",children:[e.jsx(c,{name:"settings",size:16}),e.jsx("span",{className:"hidden md:inline",children:"Admin Panel"})]}),e.jsxs(L,{href:"/profile",className:"px-2 md:px-3 py-2 rounded-lg text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500 transition-colors shadow-sm flex items-center gap-1",children:[e.jsx(c,{name:"users",size:16}),e.jsx("span",{className:"hidden md:inline",children:"Profil"})]}),e.jsxs(L,{href:"/logout",method:"post",as:"button",className:"px-2 md:px-3 py-2 rounded-lg text-sm bg-red-500 text-white hover:bg-red-600 transition-colors shadow-sm flex items-center gap-1",children:[e.jsx(c,{name:"logout",size:16}),e.jsx("span",{className:"hidden md:inline",children:"√áƒ±xƒ±≈ü"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(L,{href:"/login",className:"px-2 md:px-4 py-2 rounded-lg text-sm bg-white border text-emerald-700 hover:bg-emerald-50 dark:bg-gray-800 dark:text-emerald-400 dark:hover:bg-gray-700 transition-colors shadow-sm flex items-center gap-1",style:{borderColor:$},children:[e.jsx(c,{name:"users",size:16}),e.jsx("span",{className:"hidden md:inline",children:"Daxil ol"})]}),e.jsxs(L,{href:"/register",className:"px-2 md:px-4 py-2 rounded-lg text-sm text-white transition-colors shadow-sm flex items-center gap-1",style:{backgroundColor:$},children:[e.jsx(c,{name:"user_add",size:16}),e.jsx("span",{className:"hidden md:inline",children:"Qeydiyyat"})]})]}),e.jsxs("button",{onClick:()=>{g(null),b([])},className:"px-2 md:px-3 py-2 rounded-lg text-sm text-white transition-colors shadow-sm flex items-center gap-1",style:{backgroundColor:Te},children:[e.jsx(c,{name:"edit",size:16}),e.jsx("span",{className:"hidden md:inline",children:"Yeni s√∂hb…ôt"})]})]}),e.jsxs("div",{className:"flex md:hidden items-center gap-2 ml-auto overflow-x-auto",children:[a?.user?e.jsxs(e.Fragment,{children:[a.user.role?.name==="admin"&&e.jsx(L,{href:"/admin",className:"px-2 py-2 rounded-lg text-sm bg-purple-600 text-white hover:bg-purple-700 transition-colors shadow-sm flex items-center gap-1",children:e.jsx(c,{name:"settings",size:16})}),e.jsx(L,{href:"/profile",className:"px-2 py-2 rounded-lg text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500 transition-colors shadow-sm flex items-center gap-1",children:e.jsx(c,{name:"users",size:16})}),e.jsx(L,{href:"/logout",method:"post",as:"button",className:"px-2 py-2 rounded-lg text-sm bg-red-500 text-white hover:bg-red-600 transition-colors shadow-sm flex items-center gap-1",children:e.jsx(c,{name:"logout",size:16})})]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{href:"/login",className:"px-2 py-2 rounded-lg text-sm bg-white border text-emerald-700 hover:bg-emerald-50 dark:bg-gray-800 dark:text-emerald-400 dark:hover:bg-gray-700 transition-colors shadow-sm flex items-center gap-1",style:{borderColor:$},children:e.jsx(c,{name:"users",size:16})}),e.jsx(L,{href:"/register",className:"px-2 py-2 rounded-lg text-sm text-white transition-colors shadow-sm flex items-center gap-1",style:{backgroundColor:$},children:e.jsx(c,{name:"user_add",size:16})})]}),e.jsx("button",{onClick:()=>{g(null),b([])},className:"px-2 py-2 rounded-lg text-sm text-white transition-colors shadow-sm flex items-center gap-1",style:{backgroundColor:Te},title:"Yeni s√∂hb…ôt",children:e.jsx(c,{name:"edit",size:16})})]})]}),e.jsxs("div",{className:"flex gap-0 md:gap-2 lg:gap-3",children:[je&&e.jsx("div",{className:"md:hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-40",onClick:()=>ce(!1)}),e.jsx("aside",{className:`${je?"translate-x-0":"-translate-x-full"} md:translate-x-0 fixed md:relative top-0 left-0 z-50 md:z-auto w-80 md:w-[280px] lg:w-[300px] xl:w-[320px] h-full md:h-auto transform transition-transform duration-300 ease-in-out md:block md:flex-shrink-0`,children:e.jsxs("div",{className:"h-[80vh] md:h-[70vh] lg:h-[65vh] backdrop-blur bg-white/95 dark:bg-gray-800/95 md:bg-white/80 md:dark:bg-gray-800/80 border-r md:border border-emerald-200 dark:border-gray-600 rounded-2xl overflow-hidden p-4 md:p-3 lg:p-3 shadow-xl md:shadow-none flex flex-col",style:{minWidth:"250px"},children:[e.jsxs("div",{className:"md:hidden flex items-center gap-2 mb-4 p-3 bg-white/50 dark:bg-gray-700/50 rounded-lg",children:[r.brand_mode==="logo"&&(he||r.brand_logo_url)?e.jsx("img",{src:he||r.brand_logo_url,alt:"logo",className:"w-5 h-5 object-contain rounded"}):r.brand_mode==="icon"?e.jsx(c,{name:r.brand_icon_name||"nav_chat",size:20,color:$}):null,e.jsx("span",{className:"font-semibold text-gray-800 dark:text-gray-100 truncate",children:te})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg md:text-xs lg:text-sm font-semibold md:font-medium uppercase tracking-wider text-gray-700 dark:text-gray-300 md:text-gray-600 md:dark:text-gray-400",children:"S√∂hb…ôt Tarix√ß…ôsi"}),e.jsx("button",{onClick:()=>ce(!1),className:"md:hidden p-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(c,{name:"close",size:20})})]}),e.jsxs("div",{className:"space-y-2 max-h-[calc(80vh-8rem)] md:max-h-[calc(70vh-8rem)] lg:max-h-[calc(65vh-8rem)] overflow-auto pr-1 custom-scrollbar",children:[(a?.user?R:C).map(t=>e.jsxs("div",{className:`group relative flex items-center w-full rounded-lg text-gray-700 dark:text-gray-200 hover:bg-emerald-50 dark:hover:bg-gray-600 transition-colors ${h===t.session_id?"bg-emerald-100 dark:bg-gray-700 border-l-2":""}`,style:h===t.session_id?{borderLeftColor:$}:{},children:[e.jsxs("button",{onClick:()=>{ut(t.session_id),ce(!1)},className:"flex-1 text-left px-2 py-2 md:py-2 text-xs md:text-sm",children:[e.jsx("div",{className:"truncate font-medium max-w-[180px] md:max-w-[200px]",children:t.title||t.session_id.slice(0,8)}),!a?.user&&t.created_at&&e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:new Date(t.created_at).toLocaleDateString("az")})]}),e.jsx("button",{onClick:n=>{n.stopPropagation(),Ce(t),Se(!0)},className:"opacity-0 group-hover:opacity-100 transition-opacity px-2 py-2 text-red-500 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg mr-1",title:"S√∂hb…ôti sil",children:e.jsx(c,{name:"close",size:14})})]},t.session_id)),(a?.user?R:C).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(c,{name:"chat",size:48,color:u.isDarkMode?"#9ca3af":"#d1d5db",className:"mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Siz h…ôl…ô s√∂hb…ôt etm…ômisiniz"})]})]})]})}),e.jsx("div",{className:"flex-1 min-w-0 w-full",children:e.jsx("main",{className:"w-full max-w-none",children:e.jsxs("div",{className:`w-full backdrop-blur border border-emerald-200 dark:border-gray-600 rounded-2xl p-3 md:p-6 flex flex-col shadow-lg relative ${$e==="transparent"?"bg-white/90 dark:bg-gray-800/90":""}`,style:{minHeight:"calc(100vh - 200px)",background:$e!=="transparent"?$e:void 0,backgroundSize:y?.chat_background_type==="image"?"cover":void 0,backgroundPosition:y?.chat_background_type==="image"?"center":void 0,backgroundRepeat:y?.chat_background_type==="image"?"no-repeat":void 0},children:[e.jsxs("div",{className:"absolute top-2 right-2 z-20",children:[e.jsx("button",{onClick:()=>it(t=>!t),className:"p-2 rounded-lg bg-white/80 dark:bg-gray-700/80 border border-gray-200 dark:border-gray-600 shadow hover:shadow-md transition",title:"M…ôtn √∂l√ß√ºs√º",children:e.jsx(c,{name:"type",size:16})}),nt&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 shadow-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"M…ôtn √∂l√ß√ºs√º"}),e.jsx("input",{type:"range",min:"0.85",max:"1.4",step:"0.05",value:q,onChange:t=>ge(parseFloat(t.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("button",{onClick:()=>ge(.95),className:"px-2 py-1 text-xs rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"A-"}),e.jsx("button",{onClick:()=>ge(1),className:"px-2 py-1 text-xs rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"A"}),e.jsx("button",{onClick:()=>ge(1.2),className:"px-2 py-1 text-xs rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"A+"})]})]})]}),e.jsxs("div",{ref:T,className:"flex-1 overflow-y-auto space-y-3 pr-1 md:pr-2 custom-scrollbar",style:{maxHeight:"calc(100vh - 240px)"},children:[e.jsx(ye,{children:w.map((t,n)=>e.jsxs(z.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.2},className:`group relative max-w-[90%] md:max-w-[85%] rounded-xl px-3 md:px-4 py-2 md:py-3 ${t.role==="user"?"ml-auto bg-emerald-50 dark:bg-emerald-900/30":"mr-auto bg-gray-100 dark:bg-gray-700/80"} shadow-md border border-emerald-100 dark:border-gray-600`,style:{},children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:t.role==="user"?e.jsx("div",{className:"flex items-center gap-2",children:a?.user?e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium text-white",style:{backgroundColor:$},children:a.user.name}):e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium text-white",style:{backgroundColor:$},children:"Siz - Qonaq"})}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium text-white",style:{backgroundColor:Te},children:Pe||"AI Assistant"}),e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse",title:"AI Aktiv"})]})}),t.created_at&&e.jsxs("div",{className:"text-xs text-gray-400 flex flex-col items-end",children:[e.jsx("span",{className:"hidden md:block",children:new Date(t.created_at).toLocaleDateString("az-AZ",{day:"2-digit",month:"2-digit",year:"numeric"})}),e.jsx("span",{children:new Date(t.created_at).toLocaleTimeString("az-AZ",{hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"absolute top-1.5 right-1.5 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>ot(qe===(t.id||n)?null:t.id||n),className:"p-1.5 rounded-full bg-white/90 dark:bg-gray-800/90 border border-gray-200 dark:border-gray-600 shadow",title:"Mesaj m…ôtni √∂l√ß√ºs√º",children:e.jsx(c,{name:"type",size:12})}),qe===(t.id||n)&&e.jsxs("div",{className:"absolute right-0 mt-2 w-44 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 shadow-lg p-3 z-10",children:[e.jsx("div",{className:"text-[11px] font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bu mesaj √º√ß√ºn √∂l√ß√º"}),e.jsx("input",{type:"range",min:"0.85",max:"1.4",step:"0.05",value:ze.get(t.id)??q,onChange:i=>{const d=parseFloat(i.target.value);xe(x=>{const k=new Map(x);return k.set(t.id,d),k})},className:"w-full"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("button",{onClick:()=>xe(i=>{const d=new Map(i);return d.set(t.id,Math.max(.85,(d.get(t.id)??q)-.05)),d}),className:"px-2 py-1 text-[11px] rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"A-"}),e.jsx("button",{onClick:()=>xe(i=>{const d=new Map(i);return d.set(t.id,q),d}),className:"px-2 py-1 text-[11px] rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"Sƒ±fƒ±rla"}),e.jsx("button",{onClick:()=>xe(i=>{const d=new Map(i);return d.set(t.id,Math.min(1.4,(d.get(t.id)??q)+.05)),d}),className:"px-2 py-1 text-[11px] rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"A+"})]})]})]}),e.jsx("div",{className:"whitespace-pre-wrap leading-relaxed text-gray-800 dark:text-gray-200",style:{fontSize:`${ze.get(t.id)??q}rem`},children:t.role==="assistant"?Ye.has(t.id)?e.jsx(Gt,{text:t.fullContent,speed:mt,onComplete:()=>{b(i=>{const d=i.map(x=>x.id===t.id?{...x,content:t.fullContent,isTyping:!1}:x);return!a?.user&&h&&setTimeout(()=>{Be(h,null,d)},100),d}),ke(i=>{const d=new Set(i);return d.delete(t.id),d}),V(!1)}}):e.jsx(Ht,{content:t.content||""}):e.jsx("div",{className:"whitespace-pre-wrap",style:{fontSize:`${ze.get(t.id)??q}rem`},children:t.content})}),t.role==="assistant"&&!t.isTyping&&e.jsxs("div",{className:"flex items-center justify-start md:justify-between mt-2 flex-wrap gap-1 md:gap-2",children:[(()=>{const i=String(t.id||"");return!(Ae.has(i)||B.has(t.id))})()&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>We(String(t.id||""),t.content||t.fullContent,"like"),disabled:B.has(t.id),className:`p-1 md:p-1.5 rounded-lg transition-all group/btn ${B.get(t.id)==="like"?"text-green-600 bg-green-50 dark:bg-green-900/30":"text-gray-400 hover:text-green-500 hover:bg-green-50 dark:hover:bg-green-900/30"} disabled:opacity-50`,title:"B…ôy…ôn",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{name:"heart",size:14}),e.jsx("span",{className:"hidden md:inline text-xs opacity-0 group-hover/btn:opacity-100 transition-opacity whitespace-nowrap",children:B.get(t.id)==="like"?"B…ôy…ôndiniz":"B…ôy…ôn"})]})}),e.jsx("button",{onClick:()=>We(String(t.id||""),t.content||t.fullContent,"dislike"),disabled:B.has(t.id),className:`p-1 md:p-1.5 rounded-lg transition-all group/btn ${B.get(t.id)==="dislike"?"text-red-600 bg-red-50 dark:bg-red-900/30":"text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30"} disabled:opacity-50`,title:"B…ôy…ônm…ô",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{name:"dislike",size:14}),e.jsx("span",{className:"hidden md:inline text-xs opacity-0 group-hover/btn:opacity-100 transition-opacity whitespace-nowrap",children:B.get(t.id)==="dislike"?"B…ôy…ônm…ôdiniz":"B…ôy…ônm…ô"})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 opacity-75 hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(t.content||t.fullContent),o.success("M…ôtn kopyalandƒ±!")},className:"p-1 md:p-1.5 text-gray-400 hover:text-emerald-500 hover:bg-emerald-50 rounded-lg transition-all group/btn",title:"M…ôtn kopyala",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{name:"copy",size:14}),e.jsx("span",{className:"hidden md:inline text-xs opacity-0 group-hover/btn:opacity-100 transition-opacity whitespace-nowrap",children:"Kopyala"})]})}),e.jsx("button",{onClick:()=>{o.success("Geribildiri≈üiniz g√∂nd…ôrilir..."),(async()=>{try{const d=t.id,x=d!=null?String(d):void 0,k={message_content:t.content||t.fullContent,session_id:h,timestamp:t.created_at,user_info:a?.user?{name:a.user.name,email:a.user.email}:"Qonaq istifad…ô√ßi"};x!==void 0&&(k.message_id=x);const j=await W.post("/chat/report-feedback",k);setTimeout(()=>{o.success("Geribildiri≈üiniz g√∂nd…ôrildi!")},1e3)}catch(d){console.error("Feedback report error:",d);const x=d.response?.data?.message||d.response?.data?.error||"X…ôta ba≈ü verdi";setTimeout(()=>{o.error("Geribildiri≈ü g√∂nd…ôrilm…ôdi: "+x)},1e3)}})()},className:"p-1 md:p-1.5 text-gray-400 hover:text-orange-500 hover:bg-orange-50 rounded-lg transition-all group/btn",title:"S…ôhv cavab haqqƒ±nda bildi≈ü g√∂nd…ôr",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{name:"warning",size:14}),e.jsx("span",{className:"hidden md:inline text-xs opacity-0 group-hover/btn:opacity-100 transition-opacity whitespace-nowrap",children:"Bildir"})]})})]})]})]},t.id||n))}),U&&e.jsx(Pt,{chatbotName:Pe})]}),e.jsx("div",{className:"mt-3 md:mt-4 flex flex-col gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{ref:Z,className:`w-full ${u.isDarkMode?"glass-input-dark":"glass-input"} resize-none transition-all text-sm md:text-base pr-24 md:pr-28 min-h-[60px] md:min-h-[70px] ${ue&&X?"border-red-400 focus:ring-red-400/50 bg-red-50/50 dark:bg-red-900/50":""} ${F||D?"opacity-50 cursor-not-allowed bg-gray-100 dark:bg-gray-700":""}`,placeholder:Q?`Limit doldu - ${He(ee)}`:D?"√áatbot yazƒ±r... g√∂zl…ôyin":F?"ƒ∞stifad…ô ≈ü…ôrtl…ôrini q…ôbul edin...":"Mesajƒ±nƒ±zƒ± yazƒ±n...",value:E,onChange:t=>{if(!F&&!D){const n=t.target.value;de(O>0?n.slice(0,O):n)}try{const n=Z.current;if(n){n.style.height="auto";const i=window.innerWidth<768?160:220;n.style.height=Math.min(n.scrollHeight,i)+"px"}}catch{}},onInput:()=>{try{const t=Z.current;if(t){t.style.height="auto";const n=window.innerWidth<768?160:220;t.style.height=Math.min(t.scrollHeight,n)+"px"}}catch{}},onKeyDown:ft,disabled:F,rows:2}),e.jsx("button",{onClick:()=>be(!G),className:`absolute right-14 md:right-20 top-1/2 transform -translate-y-1/2 p-2 md:p-2.5 rounded-lg font-medium transition-all shadow-sm hover:shadow-md border ${G?"bg-emerald-500 text-white border-emerald-500":"bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 border-gray-300 dark:border-gray-600"}`,title:G?"Enter il…ô g√∂nd…ôr aktiv":"Enter il…ô g√∂nd…ôr deaktiv",children:e.jsx(c,{name:"enter",size:16})}),e.jsx("button",{onClick:()=>M||D?Xe():Oe(),disabled:ue&&X||F,className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-3 md:p-4 rounded-lg text-white font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center transition-all shadow-lg hover:shadow-xl",style:{backgroundColor:M||D||ue&&X||F?"#ef4444":$},title:M||D?"Dayandƒ±r":F?"ƒ∞stifad…ô ≈ü…ôrtl…ôrini q…ôbul edin":"G√∂nd…ôr",children:e.jsx(c,{name:M||D?"stop":F?"shield_check":"send",size:18})})]})}),ue&&e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsxs("p",{className:`text-xs transition-all ${X?"text-red-600 font-medium":xt<50?"text-yellow-600":"text-gray-500"}`,children:["Daxiletm…ô limiti ",O," simvol",re>0&&e.jsxs("span",{className:X?"text-red-600":"text-gray-400",children:["(istifad…ô edilib: ",re,")"]})]}),X&&e.jsx("p",{className:"text-xs text-red-600 font-medium",children:"‚ö†Ô∏è Limit ke√ßildi!"})]}),e.jsx("div",{className:"text-center mt-3",children:e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 px-4 py-2 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg inline-block",children:["‚ö†Ô∏è ",ct]})}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1 text-center",children:G?e.jsxs("span",{children:[e.jsx("strong",{className:"text-gray-600 dark:text-gray-300",children:"Enter"})," - g√∂nd…ôr, ",e.jsx("strong",{className:"text-gray-600 dark:text-gray-300",children:"Shift+Enter"})," - yeni s…ôtir"]}):e.jsxs("span",{children:[e.jsx("strong",{className:"text-gray-600 dark:text-gray-300",children:"Enter"})," - yeni s…ôtir"]})})]})})})]})]}),e.jsx(vt,{footerSettings:m}),e.jsx(Rt,{}),e.jsx(At,{isOpen:rt,onAccept:ht,onReject:pt,siteName:te}),Ze&&Dt.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[9999]",onClick:()=>me(!1),children:[e.jsx("div",{className:"absolute inset-0"}),e.jsxs("div",{className:"absolute w-[18rem] md:w-[20rem] p-3 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-2xl text-xs text-gray-700 dark:text-gray-200",style:{top:Fe.top,left:Fe.left},onClick:t=>t.stopPropagation(),children:[e.jsx("div",{className:"font-semibold mb-1",children:"Limit qaydasƒ±"}),I.limit_type==="monthly"?e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{children:"Aylƒ±q limit 30 g√ºnd…ôn bir b…ôrpa olunur. ƒ∞lk mesaj g√∂nd…ôrdiyiniz vaxt ba≈ülanƒüƒ±c n√∂qt…ôsidir."}),e.jsx("p",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:"N√ºmun…ô: ƒ∞lk mesajƒ± bu g√ºn 14:00-da g√∂nd…ôrmisinizs…ô, n√∂vb…ôti b…ôrpa 30 g√ºn sonra eyni tarix v…ô saatda olacaq."}),e.jsxs("p",{className:"mt-1",children:["N√∂vb…ôti b…ôrpa: ",I.monthly_reset_time?new Date(I.monthly_reset_time).toLocaleString("az-AZ"):"H…ôl…ô ba≈ülanmayƒ±b"]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{children:"G√ºnl√ºk limit yalnƒ±z 0-a d√º≈üd√ºkd…ô 24 saatlƒ±q geri sayƒ±m ba≈ülayƒ±r."}),e.jsxs("p",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:["N√ºmun…ô: D√ºn…ôn 14:00-da istifad…ô etdiniz v…ô h…ôl…ô ",I.daily_remaining??I.remaining," qalƒ±bsa, sabah 14:00-da yenil…ônmir. 0 etdiyiniz andan 24 saat sonra b…ôrpa olacaq."]}),e.jsxs("p",{className:"mt-1",children:["N√∂vb…ôti b…ôrpa: ",I.reset_time?new Date(I.reset_time).toLocaleString("az-AZ"):"Limit bitm…ôyib"]})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"font-semibold mb-0.5",children:"‚ÄúSorƒüu‚Äù n…ôdir?"}),e.jsx("p",{children:"H…ôr g√∂nd…ôrdiyiniz mesaj 1 sorƒüudur."})]})]})]}),document.body),e.jsx(qt,{isOpen:at,onConfirm:lt,onCancel:dt,chatTitle:A?.title||A?.session_id?.slice(0,8)||"",siteName:te})]})})}export{Qt as default};
